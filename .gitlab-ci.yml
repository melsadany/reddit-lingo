image: node:10.15.3-alpine

stages:
  - build

build and deploy lingo:
  stage: build
  script:
    - 'apk --no-cache --virtual build-dependencies add python make g++ && yarn && apk del build-dependencies'
    - 'apk -Uuv add groff less python py-pip'
    - 'pip install awscli'
    - 'apk --purge -v del py-pip'
    - 'rm /var/cache/apk/*'
    - yarn ng build --prod
    - echo $CI_COMMIT_REF_NAME
    - aws s3 rm s3://screener2builds/dist --recursive
    - aws s3 rm s3://screener2builds/server --recursive
    - aws s3 sync ./dist s3://screener2builds/dist
    - aws s3 sync ./server s3://screener2builds/server
    - aws s3 cp ./package.json s3://screener2builds/package.json



